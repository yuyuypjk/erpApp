<template>
    <div>
    <div class="cmui-tab">
        <div v-for="(item, key) in tabList"
             :key="key"
             class="cmui-tab-item"
             :style="[key == selectedIndex ? selectStyle : unselectStyle]"
             @click="onclickitem(key)">
            <text class="cmui-tab-text" :style="{color: key == selectedIndex ? selectedColor : ''}">{{item}}</text>
            <image :ref="key + 'ihg'" class="cmui-tab-icon" src="https://gw.alicdn.com/tps/TB1O3_aKFXXXXXdXVXXXXXXXXXX-27-23.png"></image>
        </div>
    </div >
        <div v-for="(item, key) in itemList"
             :key="key">
        <cmui-cell-item :title="item" :desc="desc"></cmui-cell-item>
        </div>
    </div>
</template>

<script>
    var modal = weex.requireModule('modal');
    var animation = weex.requireModule('animation');

    module.exports = {
        name: 'CmuiMenu',

        componentName: 'CmuiMenu',

        components: {
            CmuiCellItem: require('../cell-item/cell-item.vue')
        },

        data: function () {
            return {
                selectedIndex: 0,
                desc: ''
            }
        },
        props: {
            tabList: Array,
            itemList: Array,
            selectedColor: {
                type: String,
                default: '#FF6A00'
            }
        },
        computed: {
            selectStyle() {
                let style = {};

                style.color = this.selectedColor;
                style.borderBottomColor = this.selectedColor;
                style.borderBottomWidth = 2;

                return style;
            },
            unselectStyle() {
                let style = {};

                style.color = '#666';
                style.borderBottomColor = '#DCDED3';
                style.borderBottomWidth = 1;

                return style;
            }
        },

        methods: {
            onclickitem(index) {

                this.selectedIndex = index;
//                this.select(index);
//                this.$emit('tabItemOnClick', index);

                this.rotate(index);
            },
            anim: function(index, styles, timingFunction, duration, callback) {
//                modal.alert({message: "onclickitem"+ JSON.stringify(this.$refs) });
//                modal.alert({message: this.$refs[index+ 'ihg']});
                animation.transition(this.$refs[index+'ihg'][0], {
                    styles: styles,
                    timingFunction: timingFunction,
                    duration: duration
                }, callback);
            },
            rotate: function(index) {
                var self = this;
                if(!self.current_rotate) {
                    self.current_rotate = 0;
                }
                self.current_rotate += 180;
                self.anim(index,{
                    transform: 'rotate(' + self.current_rotate + 'deg)'
                }, 'linear', 100);
            }
        }
    }
</script>

<style lang="sass" scoped>
    @import './menu.scss';
</style>
